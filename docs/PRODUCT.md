# 产品功能文档

## 目录

- [产品概述](#产品概述)
- [核心功能](#核心功能)
- [用户界面](#用户界面)
- [使用指南](#使用指南)
- [功能详解](#功能详解)
- [常见问题](#常见问题)

## 产品概述

YouTube Live Translate 是一款 Chrome 浏览器扩展，为 YouTube 视频提供实时字幕翻译功能。通过智能的文本检测和翻译技术，用户可以实时看到翻译后的字幕，打破语言障碍。

### 产品定位

- **目标用户**：观看外语视频的 YouTube 用户
- **使用场景**：学习外语、观看国外内容、跨语言交流
- **核心价值**：实时翻译、智能刷新、不干扰原视频体验

## 核心功能

### 1. 实时字幕翻译

**功能描述**：自动监听 YouTube 视频的字幕变化，实时翻译成用户选择的目标语言。

**特点**：
- 自动检测字幕变化
- 支持增量翻译（只翻译新增内容）
- 智能刷新策略（避免频繁闪烁）

**使用方式**：
1. 打开有字幕的 YouTube 视频
2. 确保扩展已启用
3. 字幕会自动出现并翻译

### 2. 双行显示模式

**功能描述**：同时显示原文和译文，原文在上，译文在下。

**布局**：
```
┌─────────────────────────────┐
│  原文（半透明，14px）        │
│  译文（白色，可配置大小，最多2行） │
└─────────────────────────────┘
```

**特点**：
- 原文字体较小（14px），半透明显示
- 译文字体大小可配置：小（18px）/ 中（22px，默认）/ 大（26px）
- 译文最多显示 2 行，超出部分省略

### 3. 拖拽定位

**功能描述**：用户可以拖拽字幕控件到屏幕任意位置；默认位置为视频底部居中（距底部约 120px）。

**操作方式**：
1. 鼠标移动到字幕控件上
2. 按住鼠标左键拖动
3. 松开鼠标完成定位
4. 位置自动保存，下次访问恢复
5. 可在扩展弹窗中关闭再开启「启用翻译」以恢复默认底部居中（或刷新页面）

**特点**：
- 默认通过 CSS（`left: 50%` + `transform: translateX(-50%)`）实现底部居中，不依赖像素计算
- 整个控件区域可拖拽（关闭按钮与文本区域不触发拖拽）
- 拖拽时有光标反馈（grab → grabbing）
- 位置信息持久化存储（`chrome.storage.sync`）
- 全屏时不做控件迁移，控件仍相对于初始挂载的播放器定位

### 4. 广告检测

**功能描述**：自动检测 YouTube 广告播放，广告期间隐藏字幕翻译。

**检测机制**：
- 检测广告播放器元素
- 检测播放器容器类名变化
- 每秒检查一次广告状态

**特点**：
- 广告开始时自动隐藏
- 广告结束后自动显示
- 无需用户手动操作

### 5. 隐藏原字幕

**功能描述**：可选择隐藏 YouTube 原生字幕，只显示翻译后的字幕。

**效果**：
- 隐藏 YouTube 自带的字幕
- 只显示扩展的翻译字幕
- 界面更加清爽

**技术实现**：
- 使用 MutationObserver 持续监听
- 动态隐藏新出现的字幕元素
- 可通过设置开关切换

### 6. 快捷键支持

仅保留**开启/关闭插件**快捷键，修饰键兼容 **Windows/Linux**（Alt）与 **Mac**（Option 或 Command），按键不区分大小写。

| 按键 | 功能 |
|--------|------|
| `Modifier + E` | 开启/关闭插件（切换翻译启用状态） |

## 用户界面

### 设置面板

点击浏览器工具栏的扩展图标，打开设置面板。

#### 控件说明

**启用翻译**
- 类型：开关按钮
- 默认状态：开启
- 说明：控制是否启用字幕翻译功能

**目标语言**
- 类型：下拉选择
- 默认值：简体中文
- 可选：10 种语言
- 说明：选择翻译的目标语言

**显示原文**
- 类型：开关按钮
- 默认状态：关闭
- 说明：是否在译文字幕上方显示原文

**隐藏 YouTube 原字幕**
- 类型：开关按钮
- 默认状态：关闭
- 说明：是否隐藏 YouTube 自带的字幕

**翻译内容对齐**
- 类型：下拉选择
- 可选：左对齐、居中对齐、右对齐
- 默认值：居中对齐
- 说明：翻译控件内原文与译文的文本对齐方式

**译文字体大小**
- 类型：下拉选择
- 可选：小、中、大（对应 18px、22px、26px）
- 默认值：中
- 说明：翻译后译文的显示字体大小

### 字幕控件

#### 视觉设计

```
┌────────────────────────────────────────────┐
│  ━━━━━━━━━━━                             │ ← 拖拽区域（光标变为 grab）
│  This is the original text...             │ ← 原文（rgba(255,255,255,0.6)）
│  这是翻译后的文本内容...                   │ ← 译文（rgb(255,255,255)）
│                                    [✕]    │ ← 关闭按钮
└────────────────────────────────────────────┘
```

#### 样式规范

- **背景色**：`rgba(0, 0, 0, 0.6)` - 半透明黑色
- **圆角**：8px
- **内边距**：12px 20px
- **最大宽度**：800px
- **字体**：系统字体栈（-apple-system, BlinkMacSystemFont, 'Segoe UI', Arial）

#### 交互反馈

| 交互 | 反馈 |
|------|------|
| 鼠标悬停 | 光标变为 grab（可拖拽） |
| 开始拖拽 | 光标变为 grabbing |
| 悬停关闭按钮 | 背景变为淡红色 `rgba(255, 100, 100, 0.15)` |
| 点击关闭按钮 | 字幕控件隐藏 |

**说明**：关闭按钮为垂直居中对齐，默认背景透明，悬停时轻微高亮。

## 使用指南

### 首次使用

1. **安装扩展**
   - 下载扩展文件
   - 在 Chrome 中加载扩展
   - 确认扩展已启用

2. **观看视频**
   - 访问 YouTube
   - 播放有字幕的视频
   - 字幕控件会自动出现

3. **调整设置**
   - 点击扩展图标
   - 选择目标语言
   - 根据需要开启/关闭功能

### 日常使用

#### 查看原文

在设置中开启「显示原文」即可在译文字幕上方显示原文。

#### 调整位置

1. 鼠标移动到字幕控件上
2. 拖动到合适位置
3. 松开鼠标
4. 位置会自动保存

#### 重置位置

若字幕位置不理想，可拖拽到目标位置，或刷新页面后控件会恢复默认底部居中。

#### 隐藏字幕

点击字幕控件右上角的 ✕ 按钮可关闭当前页的字幕显示。

#### 重新显示

若已关闭字幕，可点击扩展图标打开设置，确认「启用翻译」为开启状态；或使用快捷键 `Modifier + E` 先关闭再开启插件以恢复显示。

## 功能详解

### 智能刷新策略

为避免界面频繁闪烁，采用智能刷新策略：

| 场景 | 行为 | 说明 |
|------|------|------|
| 新句子 | 刷新 UI + 翻译 | 文本变短，说明是新句子 |
| 文本超长（>200字符） | 截断 + 立即翻译 | 超过长度限制，截取最后 150 字符 |
| 内容不同 | 刷新 UI + 翻译 | 完全不同的内容 |
| 追加文本（<200字符） | 不刷新 UI | 只更新文本，不重新翻译 |

### 增量翻译机制

YouTube 字幕是增量显示的，例如：
1. "Oh boy."
2. "Oh boy.>> Okay."
3. "Oh boy.>> Okay. No. uh Nvidia..."

扩展会：
- 检测新增的文本
- 只翻译新增部分
- 合并到已有翻译中

### 文本长度控制

为防止文本过长：
- 原文：最多 2 行（使用 `-webkit-line-clamp: 2`）
- 译文：最多 2 行（使用 `-webkit-line-clamp: 2`）
- 超出部分：省略号（...）显示

### 翻译缓存

为提升性能和减少 API 调用：
- 缓存大小：500 条
- 缓存时长：24 小时
- 淘汰策略：LRU（最近最少使用）

### 限流与实时性

为避免过于频繁的翻译请求，同时保证实时性：
- 翻译间隔：500ms（两次请求最小间隔）
- 节流：字幕变化检测 60ms
- 防抖：字幕稳定后 180ms 触发翻译
- 字幕轮询兜底：120ms 间隔
- 队列管理：使用 Set 记录正在翻译的文本

## 常见问题

### Q: 字幕不显示？

**A:** 请检查：
1. 扩展是否已启用
2. 视频是否有字幕（开启 YouTube 字幕）
3. 是否被广告影响（等待广告结束）
4. 控制台是否有错误信息

### Q: 翻译不准确？

**A:** 
1. 本项目使用免费的 Google Translate API
2. 准确性取决于 Google Translate 的质量
3. 建议使用正式的 Google Cloud Translation API

### Q: 字幕位置不理想？

**A:**
1. 拖动字幕到合适位置（位置会自动保存）
2. 或刷新页面恢复默认底部居中

### Q: 原文字幕还在，影响观看？

**A:**
1. 在设置中开启"隐藏 YouTube 原字幕"
2. 这样只会显示翻译后的字幕

### Q: 快捷键（Modifier + E）不生效？

**A:**
1. 确保焦点在浏览器页面（不是地址栏或输入框）
2. Windows/Linux 使用 Alt + E，Mac 使用 Option + E 或 Command + E
3. 某些页面可能会拦截快捷键，可尝试刷新后使用

### Q: 支持哪些语言？

**A:** 当前支持：
- 简体中文 (zh-CN)
- 繁體中文 (zh-TW)
- English (en)
- 日本語 (ja)
- 한국어 (ko)
- Español (es)
- Français (fr)
- Deutsch (de)
- Русский (ru)
- العربية (ar)

### Q: 能否添加更多语言？

**A:** 可以！在 `src/popup/App.tsx` 中的 `TARGET_LANGUAGES` 数组添加：
```typescript
const TARGET_LANGUAGES = [
  { code: 'zh-CN', name: '简体中文' },
  { code: 'pt', name: 'Português' },  // 添加新语言
  // ...
];
```

### Q: 能否用于其他视频网站？

**A:** 当前版本仅支持 YouTube。如需支持其他网站，需要：
1. 修改 `manifest.json` 中的 `matches` 配置
2. 调整字幕元素的选择器
3. 适配不同网站的 DOM 结构

## 版本历史

详见 [更新日志](CHANGELOG.md)

---

**文档版本**: 1.0.0  
**最后更新**: 2026-02-07  
**维护者**: YouTube Live Translate Team
